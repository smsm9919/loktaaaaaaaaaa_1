
{% extends "layout.html" %}
{% block title %}إضافة منتج{% endblock %}
{% block content %}
<div class="form-card">
  <h2>إضافة منتج جديد</h2>
  <form id="pform" method="post">
    <label>الاسم</label><input name="title" id="title" required>
    <label>السعر (جنيه)</label><input name="price" id="price" type="number" step="0.01" required>
    <label>الوصف</label><textarea name="description" id="description" rows="4" required></textarea>
    <label>صورة المنتج</label><input id="image" type="file" accept="image/*" required>
    <input type="hidden" name="image_url" id="image_url">
    <button type="submit">حفظ</button>
  </form>
</div>
<script>
async function uploadExternal(file){
  const fd = new FormData(); fd.append('file', file);
  const r = await fetch('/upload', { method: 'POST', body: fd });
  const j = await r.json(); if(!j.ok) throw new Error(j.error||'فشل رفع الصورة'); return j.url;
}
document.getElementById('pform').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = document.getElementById('image').files[0]; if(!f) return alert('اختر صورة');
  try{ const url = await uploadExternal(f); document.getElementById('image_url').value = url; e.target.submit(); }
  catch(err){ alert(err.message); }
});
</script>
{% endblock %}
